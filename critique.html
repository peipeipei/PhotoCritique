<!DOCTYPE html>
<html>
<head>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" href="style.css">
    <link rel="stylesheet" type="text/css" href="photopage.css">
    <link rel="stylesheet" type="text/css" href="critique.css">
    <link rel="stylesheet" type="text/css" href="vertical_navbar.css">
        <link href='http://fonts.googleapis.com/css?family=Redressed' rel='stylesheet' type='text/css'>
    <title>Critique for Bunny and Chicks</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
    <link href='http://fonts.googleapis.com/css?family=Quattrocento+Sans' rel='stylesheet' type='text/css'>
    
    
    <script type="text/javascript">

    	$(document).ready(function(){
            var offsetLeft = $("#photo").offset().left;
            var offsetTop = $("#photo").offset().top;
            var current_id = 3;
            var circle_list = [];

        $("#image").on("click", function(e){
            if ($("#annotate").hasClass("active")){
                var img = document.createElement("img");
                img.className = "img_" + current_id;
                img.src = "circle.png";
                var w = img.width;

                // center image on mouse click
                xPos = e.pageX - offsetLeft - w/2;
                yPos = e.pageY - offsetTop - w/2;

                img.style.position = "absolute"
                img.style.left = xPos + "px";
                img.style.top = yPos + "px";

                circle_list[current_id].push(img);
                console.log(circle_list);

                $("#photo").append(img);

                //$("#annotate").removeClass("active");
                //$(document.body).css({'cursor' : 'default'});  
            }
            //window.location="critique2.html"
        })

        $("#add_comment").on("click", function(){
            current_id++;
            var comment = document.createElement("div");
            $(comment).addClass("comment");
            comment.id = "comment_" + current_id;

            var textarea = document.createElement("textarea");
            textarea.id = "text_" + current_id;
            $(comment).append(textarea);

            var new_div = '<div class = "btn-toolbar"><button id = "annotate" class = "annotate btn btn-default" title = "Add annotation"><img src="circle-small.png"></button><button class = "cancel btn btn-danger pull-right" id = "cancel_' + current_id + '">Cancel</button><button class = "post btn btn-danger pull-right" id = "post_' + current_id + '">Post Comment</button></div>'
            //var post_comment = '<button class = "post btn btn-default pull-right" id = "post_' + current_id + '">Post Comment</button>'
            //var cancel = "<button class = 'cancel btn btn-default' id = 'cancel_" + current_id + "'>Cancel</button>"

            $(comment).append(new_div);
            //$(comment).append(post_comment);
            //$(comment).append(cancel);

            $("#comments").append(comment);

            $(this).attr("disabled", true);

            circle_list[current_id] = []
        })

        $(document).on("click", ".cancel", function() {
            var id = this.id.substring(7);
            $(".img_" + id).remove();
            $("#comment_" + id).remove();
            circle_list[current_id] = [];
            current_id--;

            $("#annotate").removeClass("active");
            $(document.body).css({'cursor' : 'default'}); 
            $("#add_comment").attr("disabled", false);
        })

        $(document).on("click", ".post", function() {
            var id = this.id.substring(5);
            var msg = $("#text_" + id).val();
            $("#comment_" + id).remove();

           var comment = document.createElement("div");
            $(comment).addClass("comment");
            comment.id = "comment_" + current_id;

            $(comment).append(msg);

            $("#comments").append(comment);
            $(comment).addClass("active");

            $("#annotate").removeClass("active");
            $(document.body).css({'cursor' : 'default'});  
            $("#add_comment").attr("disabled", false);

        })

    	$(document).on("click", ".comment", function(){
    		var id = this.id
    		$('.comment').each(function(i, obj) {
    			photo_id = obj.id.substring(8);
    			if (id === obj.id){
    				$("#" + obj.id).addClass("active");

                    if (photo_id < 4){
    				    $("#image").attr("src", "annotated_photos/cute-animals-group" + photo_id + ".jpg")
                    }
                    else {
                        $("#image").attr("src", "annotated_photos/cute-animals-group0.jpg");

                        // if circle group is selected, make it active
                        circle_list[photo_id].forEach(function(circle){
                            circle.src = "circle.png"
                        })
                    }
    			}
    			else {
    				$("#" + obj.id).removeClass("active");

                    // make circle group inactive if not selected
                    if (photo_id >= 4){
                        circle_list[photo_id].forEach(function(circle){
                            circle.src = "circle-faded.png"
                        })
                    }
    			}
			});
    	})

        $(document).on("click", "#annotate", function(){
            if ($(this).hasClass("active")){
                $(this).removeClass("active");
                $(document.body).css({'cursor' : 'default'});     
            }
            else {
                $(this).addClass("active");
                $(document.body).css({'cursor' : 'url("circle.png"), auto'});     
            }
        })

        $("#send_message").on("click", function(){
            window.location = "inbox.html";
        })

    	})
    </script>
</head>
<body>
   <nav class="navbar navbar-default" role="navigation">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>    
        </div>
        <!--<div class="navbar-collapse collapse">-->
            <ul class="nav navbar-nav navbar-left">
                <li><a href="gallery1.html"><img src = "logo_header.png"/></a></li>
            </ul>
            <ul class="nav navbar-nav navbar-right">
                <li><a href="gallery1.html" class="glyphicon glyphicon-user" title="Your Profile"> pikachu</a></li>
                <li><a href="inbox.html" class="glyphicon glyphicon-inbox" title="Inbox"></a></li>
                <li><a href="#" class="glyphicon glyphicon-cloud-upload" title="Upload"></a></li>
                <li><a href="#" class="glyphicon glyphicon-globe" title="Explore"></a></li>
            </ul>
        <!--</div>-->
    </nav>

<div id = "overall_container">    
<div id = "inbox">
<ul>
<li><a href = "inbox.html" style="font-weight: bold">Inbox (5)</a></li>
<li><a href = "#">Sent Critiques</a></li>
<li><a href = "critique.html">Drafts</a></li>
<li><a href = "#">Starred</a></li>
</ul>
</div>
<div id = "container">
    <div style="border-bottom: 2px solid #FF4242; font-family: Trebuchet MS; font-size: 20px">
<form class="form-horizontal">
  <div class="form-group">
    <label for="inputEmail3" class="col-sm-2 ">Subject: </label>
    <div class="col-sm-10">
      <input type="email" class="form-control" id="inputEmail3" value = "Re: Bunny and Chicks">
    </div>
  </div>
  <div class="form-group">
    <label for="inputPassword3" class="col-sm-2 ">To: </label>
    <div class="col-sm-10">
      bunnymaster
    </div>
  </div>
</form>
</div>
<div id = "photo">
    <h3>Title: Bunny and Chicks</h3>
    <img id = "image" src="annotated_photos/cute-animals-group1.jpg" style="width:512px;"/>
    <div>
        <h3>Overall Comments:</h3>
        <textarea style="width: 518px; height:150px">Great job! I really like the photo. Just work on a few things =)</textarea>
        <div class="btn-toolbar"><button id = "send_message" class="btn btn-danger">Send</button> 
        <button class="btn btn-default pull-right"><span title = "Delete" class="glyphicon glyphicon-trash"></span></button>
        <button class="btn btn-default pull-right"><span title = "Save as Draft" class="glyphicon glyphicon-save"></span></button>
    </div>
    </div>
    <!--<div><button id = "annotate" class = "btn btn-default" title = "Add annotation"><img src="circle.png"></button>
    <button id = "group" class = "btn btn-default"  title = "Group circles"><img src="circle-group.png"></button></div>-->
</div>
<div id = "comments">
	<h3>Focal Points <button id = "add_comment" class = "btn btn-default pull-right"><span class="glyphicon glyphicon-plus"></span></button></h3>
	<div class = "comment active" id="comment_1">
		These areas are in the shadow and I think they would look better if they were in light.
	</div>
	<div class = "comment" id = "comment_2">
		Great focus! I love how the whiskers and fur stand out!
	</div>
	<div class = "comment" id = "comment_3">
		I like how the background is blurred so the animals stand out.
	</div>
</div>
</div>
</div>


</body>
</html>